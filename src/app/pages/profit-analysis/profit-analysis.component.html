<div class="container-fluid p-3 p-md-4">
  <div class="d-flex flex-wrap justify-content-between align-items-center mb-4 gap-2">
    <h2 class="mb-0">Item Profit Analysis</h2>
    
    <div class="d-flex align-items-center gap-2" *ngIf="!isLoading()">
      <label class="small text-muted mb-0">Sort by:</label>
     <select class="form-select form-select-sm" style="width: auto;" [(ngModel)]="sortBy">
  <option value="quantity">Quantity Sold</option>
  <option value="profit">Total Profit</option>
  <option value="revenue">Revenue</option>
  <option value="margin">Profit Margin %</option>
</select>
    </div>
  </div>
  
  <!-- Loading State -->
  <div *ngIf="isLoading()" class="text-center p-5">
    <div class="spinner-border text-primary" role="status">
      <span class="visually-hidden">Loading...</span>
    </div>
  </div>

  <!-- Summary Cards -->
  <div class="row g-3 mb-4" *ngIf="!isLoading()">
    <div class="col-md-3">
      <div class="card shadow-sm border-0">
        <div class="card-body text-center">
          <h6 class="text-muted mb-1">Total Revenue</h6>
          <p class="fs-4 mb-0 fw-bold text-primary">&#8377;{{ totalRevenue() | number:'1.2-2' }}</p>
        </div>
      </div>
    </div>
    <div class="col-md-3">
      <div class="card shadow-sm border-0">
        <div class="card-body text-center">
          <h6 class="text-muted mb-1">Total Discount</h6>
          <p class="fs-4 mb-0 fw-bold text-warning">&#8377;{{ totalDiscount() | number:'1.2-2' }}</p>
        </div>
      </div>
    </div>
    <div class="col-md-3">
      <div class="card shadow-sm border-0">
        <div class="card-body text-center">
          <h6 class="text-muted mb-1">Total Profit</h6>
          <p class="fs-4 mb-0 fw-bold text-success">&#8377;{{ totalProfit() | number:'1.2-2' }}</p>
        </div>
      </div>
    </div>
    <div class="col-md-3">
      <div class="card shadow-sm border-0">
        <div class="card-body text-center">
          <h6 class="text-muted mb-1">Overall Margin</h6>
          <p class="fs-4 mb-0 fw-bold text-info">{{ overallMargin() | number:'1.1-1' }}%</p>
        </div>
      </div>
    </div>
  </div>

  <!-- Desktop Table View -->
  <div class="card shadow-sm border-0 d-none d-md-block" *ngIf="!isLoading()">
    <div class="card-body p-0">
      <div class="table-responsive">
        <table class="table table-hover align-middle mb-0">
          <thead class="table-light sticky-top">
            <tr>
              <th>Rank</th>
              <th>Item Name</th>
              <th class="text-end">Cost Price</th>
              <th class="text-end">Sell Price</th>
              <th class="text-end">Qty Sold</th>
              <th class="text-end">Base Revenue</th>
              <th class="text-end">Discount</th>
              <th class="text-end">Actual Revenue</th>
              <th class="text-end">Total Cost</th>
              <th class="text-end">Profit</th>
              <th class="text-end">Margin %</th>
            </tr>
          </thead>
          <tbody>
            <tr *ngFor="let item of itemProfitData(); let i = index">
              <td><span class="badge bg-secondary">{{ i + 1 }}</span></td>
              <td class="fw-medium">{{ item.itemName }}</td>
              <td class="text-end">&#8377;{{ item.costPrice | number:'1.2-2' }}</td>
              <td class="text-end">&#8377;{{ item.sellPrice | number:'1.2-2' }}</td>
              <td class="text-end fw-bold">{{ item.totalQtySold }}</td>
              <td class="text-end text-muted">&#8377;{{ item.baseRevenue | number:'1.2-2' }}</td>
              <td class="text-end text-warning fw-bold">- &#8377;{{ item.totalDiscount | number:'1.2-2' }}</td>
              <td class="text-end fw-bold text-primary">&#8377;{{ item.totalRevenue | number:'1.2-2' }}</td>
              <td class="text-end">&#8377;{{ item.totalCost | number:'1.2-2' }}</td>
              <td class="text-end fw-bold" [class.text-success]="item.totalProfit > 0" [class.text-danger]="item.totalProfit < 0">
                &#8377;{{ item.totalProfit | number:'1.2-2' }}
              </td>
              <td class="text-end" [class.text-success]="item.profitMargin > 0" [class.text-danger]="item.profitMargin < 0">
                {{ item.profitMargin | number:'1.1-1' }}%
              </td>
            </tr>
            <tr *ngIf="itemProfitData().length === 0">
              <td colspan="11" class="text-center text-muted p-4">No sales data available</td>
            </tr>
          </tbody>
        </table>
      </div>
    </div>
  </div>

  <!-- Mobile Card View -->
  <div class="d-block d-md-none" *ngIf="!isLoading()">
    <div *ngFor="let item of itemProfitData(); let i = index" class="card mb-3 shadow-sm border-0">
      <div class="card-body">
        <div class="d-flex justify-content-between align-items-start mb-2">
          <div class="d-flex align-items-center gap-2">
            <span class="badge bg-secondary">{{ i + 1 }}</span>
            <h6 class="card-title mb-0 fw-bold">{{ item.itemName }}</h6>
          </div>
          <span class="badge" [class.bg-success]="item.profitMargin > 0" [class.bg-danger]="item.profitMargin < 0">
            {{ item.profitMargin | number:'1.1-1' }}%
          </span>
        </div>

        <div class="row g-2 small mb-2">
          <div class="col-6">
            <div class="text-muted">Cost Price</div>
            <div class="fw-bold">&#8377;{{ item.costPrice | number:'1.2-2' }}</div>
          </div>
          <div class="col-6">
            <div class="text-muted">Sell Price</div>
            <div class="fw-bold">&#8377;{{ item.sellPrice | number:'1.2-2' }}</div>
          </div>
        </div>

        <div class="row g-2 small mb-2">
          <div class="col-6">
            <div class="text-muted">Qty Sold</div>
            <div class="fw-bold fs-6 text-primary">{{ item.totalQtySold }}</div>
          </div>
          <div class="col-6">
            <div class="text-muted">Base Revenue</div>
            <div class="text-muted">&#8377;{{ item.baseRevenue | number:'1.2-2' }}</div>
          </div>
        </div>

        <div class="row g-2 small mb-2">
          <div class="col-6">
            <div class="text-muted">Discount Given</div>
            <div class="fw-bold text-warning">- &#8377;{{ item.totalDiscount | number:'1.2-2' }}</div>
          </div>
          <div class="col-6">
            <div class="text-muted">Actual Revenue</div>
            <div class="fw-bold text-primary">&#8377;{{ item.totalRevenue | number:'1.2-2' }}</div>
          </div>
        </div>

        <div class="row g-2 small">
          <div class="col-6">
            <div class="text-muted">Total Cost</div>
            <div class="fw-bold">&#8377;{{ item.totalCost | number:'1.2-2' }}</div>
          </div>
          <div class="col-6">
            <div class="text-muted">Profit</div>
            <div class="fw-bold" [class.text-success]="item.totalProfit > 0" [class.text-danger]="item.totalProfit < 0">
              &#8377;{{ item.totalProfit | number:'1.2-2' }}
            </div>
          </div>
        </div>
      </div>
    </div>

    <div *ngIf="itemProfitData().length === 0" class="text-center text-muted py-5">
      No sales data available
    </div>
  </div>
</div>
