<div class="container-fluid p-3 p-md-4">
  <div class="mb-4">
    <h2 class="mb-0">Dashboard</h2>
    <small class="text-muted">Business and inventory overview</small>
  </div>

  <!-- SECTION 1: Overall Business Health -->
  <div class="row">
    <div class="col-sm-6 col-xl-3 mb-4">
      <div class="card h-100 shadow-sm border-0">
        <div class="card-body">
          <h6 class="text-muted mb-2">Total Stock Value (at Cost)</h6>
          <div class="fs-4 fw-semibold">&#8377;{{ totalStockValueAtCost() | number:'1.2-2' }}</div>
        </div>
      </div>
    </div>
    <div class="col-sm-6 col-xl-3 mb-4">
      <div class="card h-100 shadow-sm border-0">
        <div class="card-body">
          <h6 class="text-muted mb-2">Total Stock Value (at Sell)</h6>
          <div class="fs-4 text-success fw-semibold">&#8377;{{ totalStockValueAtSell() | number:'1.2-2' }}</div>
        </div>
      </div>
    </div>
  <!-- <div class="card h-100 shadow-sm border-0">
    <div class="card-body text-center">
      <h6 class="text-muted">Estimated Stock Profit</h6>
      <p class="fs-4 mb-0 fw-bold text-success">&#8377;{{ estimatedStockProfit() | number:'1.2-2' }}</p>
      <small class="text-muted">Profit if all stock sold at current prices</small>
    </div>
  </div>
</div> -->
    
    <div class="col-sm-6 col-xl-3 mb-4">
      <div class="card h-100 shadow-sm border-0">
        <div class="card-body">
          <h6 class="text-muted mb-2">All-Time Sales</h6>
          <div class="fs-4 fw-semibold text-primary">&#8377;{{ allTimeTotalSales() | number:'1.2-2' }}</div>
        </div>
      </div>
    </div>
    <div class="col-sm-6 col-xl-3 mb-4">
      <div class="card h-100 shadow-sm border-0">
        <div class="card-body">
          <h6 class="text-muted mb-2">All-Time Profit</h6>
          <div class="fs-4 fw-semibold text-success">&#8377;{{ allTimeTotalProfit() | number:'1.2-2' }}</div>
        </div>
      </div>
    </div>
  </div>

  <hr class="my-4">

  <!-- SECTION 2: Time-Based Analysis -->
  <div class="row g-4">
    <!-- Left Column: Controls and Filtered Metrics -->
    <div class="col-xl-4">
      <div class="card shadow-sm border-0">
        <div class="card-header bg-white">
          <h5 class="mb-0">Analyze Period</h5>
        </div>
        <div class="card-body">
          <!-- Date Range Picker -->
          <div class="row g-2 align-items-center mb-4">
            <div class="col">
              <label class="form-label">Start Date</label>
              <input type="date" class="form-control" [value]="startDate()" (change)="startDate.set($any($event.target).value); onDateChange()">
            </div>
            <div class="col">
              <label class="form-label">End Date</label>
              <input type="date" class="form-control" [value]="endDate()" (change)="endDate.set($any($event.target).value); onDateChange()">
            </div>
          </div>

          <!-- Filtered Metrics -->
          <div class="d-flex justify-content-between mb-2">
            <span class="text-muted">Sales in Period:</span>
            <span class="fw-bold fs-5">&#8377;{{ filteredTotalSales() | number:'1.2-2' }}</span>
          </div>
          <div class="d-flex justify-content-between">
            <span class="text-muted">Profit in Period:</span>
            <span class="fw-bold fs-5 text-success">&#8377;{{ filteredTotalProfit() | number:'1.2-2' }}</span>
          </div>

            <div class="d-flex justify-content-between">
            <span class="text-muted">Cash payments:</span>
            <span class="fw-bold fs-5 text-info">&#8377;{{ filteredCashPayments() | number:'1.2-2' }}</span>
        
          </div>  <div class="d-flex justify-content-between">
            <span class="text-muted">UPI payments:</span>
            <span class="fw-bold fs-5 text-warning">&#8377;{{ filteredUpiPayments() | number:'1.2-2' }}</span>
          </div>
        </div>
      </div>
      
      <!-- Top Selling Item Card -->
      <div class="card shadow-sm border-0 mt-4">
        <div class="card-body text-center">
            <h6 class="text-muted mb-2">Top Seller in Period</h6>
            <div *ngIf="filteredTopSellingItem() as topItem; else noTopItem">
              <div class="fs-5 fw-semibold mb-0 text-truncate" [title]="topItem.name">{{ topItem.name }}</div>
              <small class="text-muted">Sold: {{ topItem.count }} units</small>
            </div>
            <ng-template #noTopItem>
              <span class="text-muted">No sales in this period.</span>
            </ng-template>
        </div>
      </div>
    </div>

    <!-- Right Column: Chart -->
    <div class="col-xl-8">
      <div class="card shadow-sm border-0" style="height: 500px;">
        <div class="card-body d-flex flex-column">
          <h5 class="card-title mb-3">Sales & Profit Trend</h5>
          <div class="flex-grow-1">
            <div *ngIf="!isLoading()" class="h-100">
              <canvas *ngIf="filteredInvoices().length > 0; else noChartData" baseChart class="h-100" [data]="lineChartData" [options]="lineChartOptions" [type]="'line'"></canvas>
              <ng-template #noChartData>
                <div class="d-flex align-items-center justify-content-center h-100 text-muted">No sales data in selected range.</div>
              </ng-template>
            </div>
            <div *ngIf="isLoading()" class="d-flex align-items-center justify-content-center h-100">
              <div class="spinner-border text-primary" role="status">
                <span class="visually-hidden">Loading...</span>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>
<div class="card shadow-sm border-0 mt-4">
    <div class="card-body">
      <h5 class="card-title mb-4">Stock(Left) Value by Category</h5>
      <div class="row g-4 align-items-center">
        <!-- Doughnut Chart Column -->
        <div class="col-md-5">
          <div style="height: 250px;">
            <canvas baseChart
              [data]="doughnutChartData"
              [type]="'doughnut'"
              [options]="doughnutChartOptions">
            </canvas>
          </div>
        </div>
        <!-- Category List Column -->
        <div class="col-md-7">
          <ul class="list-group list-group-flush">
            <li *ngFor="let category of stockByCategory()" class="list-group-item d-flex justify-content-between align-items-center">
              {{ category.name }}
              <span class="badge bg-primary rounded-pill">&#8377;{{ category.value | number:'1.0-0' }}</span>
            </li>
            <li *ngIf="stockByCategory().length === 0" class="list-group-item text-muted">
              No stock data available.
            </li>
          </ul>
        </div>
      </div>
    </div>
  </div>